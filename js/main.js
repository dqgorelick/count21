var cards=new Array(104),deck_count=0,gamemode=0,player={hand:[],aces:0,total:[],span:".player span",total_display:".player_total span",bust:!1,blackjack:!1,chips:2e3},dealer={hand:[],aces:0,total:[],span:".dealer span",total_display:".dealer_total span",bust:!1,blackjack:!1},game={playerwin:0,result:"",gameover:1,count:0,count_hidden:!0,pot:0,max_pot_size:1e3};$(document).ready(function(){setup(),betting(0),shuffle()});var gamecontrol=function(a){1===a?(gamemode=1,deal()):2===a?(gamemode=2,gameplay()):3===a&&(gamemode=3,results())},betting=function(a){-1===a?(player.chips+=game.pot,game.pot=0):player.chips-a>0&&game.pot<game.max_pot_size&&(game.pot+=a,player.chips-=a,game.pot>game.max_pot_size&&(player.chips-=game.max_pot_size-game.pot,game.pot=game.max_pot_size)),$(".player-chips span").html(player.chips),$(".pot span").html(game.pot)},draw=function(a){a.hand.push(cards[deck_count]),game.count+=counting(value(cards[deck_count])),deck_count++},gameplay=function(){player.bust===!0?(playerwin=2,console.log("player loses")):dealer.bust?(playerwin=1,console.log("player wins")):player.total[0]>dealer.total[0]||player.total[1]>dealer.total[0]?(playerwin=1,console.log("player wins")):(playerwin=3,console.log("player ties")),gamecontrol(3)},results=function(){1===playerwin?(player.chips+=2*game.pot,game.pot=0,betting(-1)):2===playerwin?(game.pot=0,betting(-1)):3===playerwin&&(player.chips+=game.pot,game.pot=0,betting(-1))},counting=function(a){return a>=2&&7>a?1:10===a||1===a?-1:0},player_draw=function(){player.total[0]<=21&&1===game.gameover&&(draw(player),update()),player.total[0]>21&&0===player.aces&&(player.bust=!0),player.total[0]>21&&player.total[1]>21&&(player.bust=!0),player.bust===!0&&gamecontrol(2)},dealer_draw=function(){if(game.gameover=0,dealer.blackjack!==!0)for(;dealer.total[0]<17;)draw(dealer),update();dealer.total[0]>21&&0===dealer.aces&&(dealer.bust=!0),dealer.total[0]>21&&dealer.total[1]>21&&(dealer.bust=!0),update(),gamecontrol(2)},update=function(){for(var a="",b="",c=0;c<player.hand.length;c++)a+='<div class="card"><p>'+face(player.hand[c])+'</p><img class="suit" src="img/'+suit(player.hand[c])+'.svg"/></div>';$(player.span).html(a),1===game.gameover&&(b+='<div class="card"><p>?<p></div>');for(var d=game.gameover;d<dealer.hand.length;d++)b+='<div class="card"><p>'+face(dealer.hand[d])+'</p><img class="suit" src="img/'+suit(dealer.hand[d])+'.svg"/></div>';$(dealer.span).html(b),1===game.gameover&&game.count_hidden===!0&&(-1===counting(value(dealer.hand[0]))&&(game.count+=1),1===counting(value(dealer.hand[0]))&&(game.count-=1),game.count_hidden=!1),0===game.gameover&&game.count_hidden===!1&&(-1===counting(value(dealer.hand[0]))&&(game.count-=1),1===counting(value(dealer.hand[0]))&&(game.count+=1),game.count_hidden=!0),$(".count span").html(game.count),score_handler(player),score_handler(dealer),score_display(player),score_display(dealer)},reset=function(){playerwin=!1,game.count_hidden=!0,player.total=[0,0],dealer.total=[0,0],player.aces=0,dealer.aces=0,player.hand=[],dealer.hand=[],player.bust=!1,dealer.bust=!1,player.blackjack=!1,dealer.blackjack=!1,update(),game.gameover=1},score_handler=function(a){a.total[0]=0,a.total[1]=0;for(var b=0;b<a.hand.length;b++)a.total[0]+=value(a.hand[b]),1===value(a.hand[b])&&a.aces++;0!==a.aces&&(a.total[1]=a.total[0]+10),(21===a.total[0]||21===a.total[1])&&(a.blackjack=!0,console.log(a["this"]+"has blackjack!"))},score_display=function(a){$(a.total_display).html(0!==a.total[1]&&a.total[1]<22?a.total[1]+" or "+a.total[0]:a.total[0]),1===game.gameover&&$(dealer.total_display).html(value(dealer.hand[1]))},value=function(a){return a%13>=10?10:a%13+1},face=function(a){switch(a%13){case 0:return"A";case 10:return"J";case 11:return"Q";case 12:return"K";default:return(a%13+1).toString()}},suit=function(a){return 13>a?"spade":a>=13&&26>a?"diamond":a>=26&&39>a?"club":a>=39?"heart":void 0},setup=function(){for(var a=0;a<cards.length;a++)cards[a]=Math.floor(a/2)},deal=function(){draw(player),draw(dealer),draw(player),draw(dealer),update()},shuffle=function(){var c;game.count=0;for(var d=0;1e3>d;d++)a=Math.floor(52*Math.random()),b=Math.floor(52*Math.random()),c=cards[a],cards[a]=cards[b],cards[b]=c};